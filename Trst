#!/bin/bash


echo "Vérification des variables définies dans $VAR_FILE..."
echo "Recherche dans : $SCRIPTS_DIR (Les liens symboliques seront ignorés)"
echo "---------------------------------------------------"
echo "## Variables qui NE sont PAS utilisées :"

# Récupération des variables exportées (Votre ligne d'origine)
VARS=$(grep -oP '^[[:space:]]*export[[:space:]]+[A-Z_][A-Z0-9_]*' "$VAR_FILE" | awk '{print $NF}')

for var in $VARS; do
    # -------------------------------------------------------------------------
    # Recherche corrigée pour une sortie silencieuse et sans erreur :
    # -R : Récursif
    # -q : Silencieux (empêche l'affichage des lignes trouvées)
    # -D skip : Ignore explicitement les liens symboliques problématiques
    # 2>/dev/null : Masque les messages d'erreur (dont "Too many levels...")
    # -------------------------------------------------------------------------
    
    if grep -R -q -D skip --exclude="$VAR_FILE" "$var" "$SCRIPTS_DIR" 2>/dev/null; then
        : # Utilisé, on ne fait rien
    else
        # NON utilisé, on affiche clairement le résultat
        echo "∆ $var n'est pas utilisé"
    fi
done

echo "---------------------------------------------------"
echo "Vérification terminée."




#!/bin/bash


echo "Vérification des variables définies dans $VAR_FILE..."
echo "Recherche dans : $SCRIPTS_DIR"
echo "---------------------------------------------------"
echo "## Variables qui NE sont PAS utilisées :"

VARS=$(grep -oP '^[[:space:]]*export[[:space:]]+[A-Z_][A-Z0-9_]*' "$VAR_FILE" | awk '{print $NF}')

for var in $VARS; do
    
    if grep -R -q -D skip --exclude="$VAR_FILE" "$var" "$SCRIPTS_DIR" 2>/dev/null; then
        :
    else
        echo "∆ $var n'est pas utilisé"
    fi
done

echo "---------------------------------------------------"
echo "Vérification terminée."
