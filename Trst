#!/bin/bash


echo "Vérification des variables définies dans $VAR_FILE..."
echo "Recherche dans : $SCRIPTS_DIR (Les liens symboliques seront ignorés)"
echo "---------------------------------------------------"
echo "## Variables qui NE sont PAS utilisées :"

# Récupération des variables exportées (Votre ligne d'origine)
VARS=$(grep -oP '^[[:space:]]*export[[:space:]]+[A-Z_][A-Z0-9_]*' "$VAR_FILE" | awk '{print $NF}')

for var in $VARS; do
    # -------------------------------------------------------------------------
    # Recherche corrigée pour une sortie silencieuse et sans erreur :
    # -R : Récursif
    # -q : Silencieux (empêche l'affichage des lignes trouvées)
    # -D skip : Ignore explicitement les liens symboliques problématiques
    # 2>/dev/null : Masque les messages d'erreur (dont "Too many levels...")
    # -------------------------------------------------------------------------
    
    if grep -R -q -D skip --exclude="$VAR_FILE" "$var" "$SCRIPTS_DIR" 2>/dev/null; then
        : # Utilisé, on ne fait rien
    else
        # NON utilisé, on affiche clairement le résultat
        echo "∆ $var n'est pas utilisé"
    fi
done

echo "---------------------------------------------------"
echo "Vérification terminée."




#!/bin/bash


echo "Vérification des variables définies dans $VAR_FILE..."
echo "Recherche dans : $SCRIPTS_DIR"
echo "---------------------------------------------------"
echo "## Variables qui NE sont PAS utilisées :"

VARS=$(grep -oP '^[[:space:]]*export[[:space:]]+[A-Z_][A-Z0-9_]*' "$VAR_FILE" | awk '{print $NF}')

for var in $VARS; do
    
    if grep -R -q -D skip --exclude="$VAR_FILE" "$var" "$SCRIPTS_DIR" 2>/dev/null; then
        :
    else
        echo "∆ $var n'est pas utilisé"
    fi
done

echo "---------------------------------------------------"
echo "Vérification terminée."






#!/bin/bash


# Initialisation des compteurs
VARS_TOTAL=0
VARS_USED=0
VARS_UNUSED=0

echo "Vérification des variables définies dans $VAR_FILE..."
echo "Recherche dans : $SCRIPTS_DIR"
echo "---------------------------------------------------"

# Récupération des variables exportées
VARS=$(grep -oP '^[[:space:]]*export[[:space:]]+[A-Z_][A-Z0-9_]*' "$VAR_FILE" | awk '{print $NF}')

# Décompte du total des variables trouvées
VARS_TOTAL=$(echo "$VARS" | wc -l)

echo "## Variables qui NE sont PAS utilisées :"

for var in $VARS; do
    
    if grep -R -q -D skip --exclude="$VAR_FILE" "$var" "$SCRIPTS_DIR" 2>/dev/null; then
        # Variable utilisée
        VARS_USED=$((VARS_USED + 1))
    else
        # Variable NON utilisée
        echo "∆ $var n'est pas utilisé"
        VARS_UNUSED=$((VARS_UNUSED + 1))
    fi
done

echo "---------------------------------------------------"

## Affichage des statistiques
echo "### Statistiques de la vérification"
echo "Total de variables exportées : $VARS_TOTAL"
echo "Variables utilisées          : $VARS_USED"
echo "Variables non utilisées      : $VARS_UNUSED"

echo "---------------------------------------------------"
echo "Vérification terminée."
